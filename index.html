<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página de Inicio</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            width: 100vw; min-height: 100vh; display: flex; align-items: center; justify-content: center;
            background: linear-gradient(135deg, #0e0e0e, #000000);
            font-family: 'Inter', Arial, sans-serif; color: white; padding: 20px;
        }
        .main-content { display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; max-width: 1400px; text-align: center; }
        #auth-container { display: flex; flex-direction: column; align-items: center; }
        #google-signin-btn { background-color: #4285F4; color: white; border: none; border-radius: 8px; padding: 12px 24px; font-size: 16px; font-weight: bold; cursor: pointer; transition: background-color 0.3s; display: flex; align-items: center; gap: 10px; }
        #google-signin-btn:hover { background-color: #357ae8; }
        #google-signin-btn svg { width: 20px; height: 20px; fill: white; }
        #user-info { display: none; align-items: center; gap: 15px; margin-bottom: 25px; background: rgba(255, 255, 255, 0.1); padding: 10px 20px; border-radius: 50px; }
        #user-info img { width: 40px; height: 40px; border-radius: 50%; }
        #user-name { font-weight: bold; }
        #signout-btn { background: #db4437; color: white; border: none; border-radius: 8px; padding: 8px 16px; cursor: pointer; transition: background-color 0.3s; font-weight: bold; }
        #signout-btn:hover { background: #c23327; }
        #dashboard { display: none; width: 100%; display: grid; grid-template-columns: 1fr; gap: 20px; align-items: start; }
        #search-sidebar { padding: 20px; background: rgba(255, 255, 255, 0.05); border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.1); display: flex; flex-direction: column; gap: 25px; }
        .search-form h3 { margin-bottom: 15px; font-size: 18px; color: #eee; text-align: left; }
        .search-input-wrapper { position: relative; }
        .search-input { width: 100%; padding: 12px 15px 12px 40px; background-color: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; color: white; font-size: 16px; }
        .search-input:focus { outline: none; border-color: #4285F4; }
        .search-input-wrapper svg { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); width: 20px; height: 20px; fill: #aaa; }
        
        #gemini-response-area { margin-top: 10px; text-align: left; background-color: rgba(0, 0, 0, 0.2); border-radius: 8px; padding: 15px; min-height: 50px; font-size: 14px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word; }
        .loader { width: 20px; height: 20px; border: 3px solid #4a4a4a; border-bottom-color: transparent; border-radius: 50%; display: inline-block; box-sizing: border-box; animation: rotation 1s linear infinite; }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Estilos para el gestor de API Key */
        #api-key-setup { display: none; /* Oculto por defecto */ padding: 10px; border: 1px dashed #444; border-radius: 8px; margin-top: 15px; }
        #api-key-setup p { font-size: 14px; margin-bottom: 10px; text-align: left; }
        #api-key-input { width: 100%; margin-bottom: 10px; }
        #save-api-key-btn { width: 100%; padding: 8px; background-color: #4285F4; border: none; border-radius: 6px; color: white; font-weight: bold; cursor: pointer; }
        #api-key-setup a { font-size: 12px; color: #8ab4f8; }

        .shortcuts-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; width: 100%; }
        .shortcut { background: rgba(255, 255, 255, 0.08); border-radius: 10px; padding: 15px; transition: transform 0.3s, background 0.3s; font-size: 14px; font-weight: bold; display: flex; flex-direction: column; align-items: center; justify-content: center; aspect-ratio: 1 / 0.8; border: 1px solid rgba(255, 255, 255, 0.1); }
        .shortcut:hover { background: rgba(255, 255, 255, 0.15); transform: translateY(-5px); }
        .shortcut a { text-decoration: none; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; height: 100%; }
        .shortcut span { font-size: 12px; font-weight: normal; color: #ccc; margin-top: 4px; }
        
        @media (min-width: 992px) { #dashboard { grid-template-columns: 380px 1fr; } }
    </style>
</head>
<body>

    <div class="main-content">
        <!-- Contenedor de Autenticación -->
        <div id="auth-container">
            <h1 style="margin-bottom: 20px;">Mi Página de Inicio</h1>
            <button id="google-signin-btn">
                <svg viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.42-4.55H24v8.51h12.8c-.57 3.33-2.31 6.17-4.79 8.09l7.98 6.19c4.69-4.34 7.42-10.74 7.42-18.24z"></path><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.98-6.19c-2.11 1.45-4.82 2.3-7.91 2.3-6.27 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path><path fill="none" d="M0 0h48v48H0z"></path></svg>
                <span>Iniciar sesión con Google</span>
            </button>
        </div>

        <!-- Información del Usuario -->
        <div id="user-info">
            <img id="user-photo" src="" alt="Foto de perfil">
            <span id="user-name"></span>
            <button id="signout-btn">Salir</button>
        </div>

        <!-- Dashboard -->
        <div id="dashboard">
            <div id="search-sidebar">
                <!-- Búsqueda de Google -->
                <form class="search-form" action="https://www.google.com/search" method="get" target="_blank">
                    <h3>Búsqueda de Google</h3>
                    <div class="search-input-wrapper">
                         <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 18a7.952 7.952 0 0 0 4.897-1.688l4.396 4.396 1.414-1.414-4.396-4.396A7.952 7.952 0 0 0 18 10c0-4.411-3.589-8-8-8s-8 3.589-8 8 3.589 8 8 8zm0-14c3.309 0 6 2.691 6 6s-2.691 6-6 6-6-2.691-6-6 2.691-6 6-6z"></path></svg>
                        <input type="text" name="q" class="search-input" placeholder="Buscar en Google..." required>
                    </div>
                </form>

                <!-- Chat con Gemini -->
                <form id="gemini-search-form" class="search-form">
                    <h3>Chat con Gemini</h3>
                    <div class="search-input-wrapper">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Zm-1.5 19a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3ZM19.5 10.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm-15-2.25a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0Z M16.65 6.4a1.5 1.5 0 1 1-2.121-2.122 1.5 1.5 0 0 1 2.121 2.122ZM7.35 17.6a1.5 1.5 0 1 0-2.121 2.121 1.5 1.5 0 0 0 2.121-2.121Z"></path><path d="M12.44 8.35a1.5 1.5 0 1 1-2.122-2.122A1.5 1.5 0 0 1 12.44 8.35ZM8.35 12.44a1.5 1.5 0 1 0-2.122 2.121 1.5 1.5 0 0 0 2.122-2.121Z"></path></svg>
                        <input type="text" id="gemini-search-input" class="search-input" placeholder="Preguntar a Gemini..." required>
                    </div>
                </form>
                <div id="gemini-response-area"></div>
                <!-- Gestor de API Key -->
                <div id="api-key-setup">
                    <p><b>Se necesita una API Key de Gemini.</b></p>
                    <input type="password" id="api-key-input" class="search-input" placeholder="Pega tu clave de API aquí">
                    <button id="save-api-key-btn">Guardar Clave</button>
                    <a href="https://aistudio.google.com/app/apikey" target="_blank">Obtener una clave de API nueva</a>
                </div>
            </div>
            
            <!-- Contenedor de Accesos Directos -->
            <div class="shortcuts-container" id="shortcuts">
                <div class="shortcut"><a href="https://gemini.google.com/u/0/app">Gemini</a></div>
                <div class="shortcut"><a href="https://aistudio.google.com/library">AI-studio</a></div>
                <div class="shortcut"><a href="https://youtube.com" >YouTube</a></div>
                <div class="shortcut"><a href="https://music.youtube.com/playlist?list=LM" >YOUTUBE<br><span>music</span></a></div>
                <div class="shortcut"><a href="https://drive.google.com/drive/recent">GOOGLE<br><span>drive</span></a></div>
                <div class="shortcut"><a href="https://keep.google.com/">GOOGLE<br><span>keep</span></a></div>
                <div class="shortcut"><a href="https://docs.google.com/presentation/u/0/">GOOGLE<br><span>diapositivas</span></a></div>
                <div class="shortcut"><a href="https://us-east-2.console.aws.amazon.com/lambda/home?region=us-east-2#/discover">Lambda</a></div>
                <div class="shortcut"><a href="https://us-east-2.console.aws.amazon.com/dynamodbv2/home?region=us-east-2#dashboard">DynamoDB</a></div>
                <div class="shortcut"><a href="https://html.onlineviewer.net/">HTML Viewer</a></div>
                <div class="shortcut"><a href="https://github.com/sadekyamil?tab=repositories">GITHUB<br><span>/sadekyamil</span></a></div>
                <div class="shortcut"><a href="https://idx.google.com/pythonpy-86921935">FIREBASE-STUDIO<br><span>(mi-1er-python)</span></a></div>
                <div class="shortcut"><a href="https://idx.google.com/">IDX Google</a></div>
                <div class="shortcut"><a href="https://github.com/sadeknifuri/ladingpage">REPOSITORIO<br><span>BigoteMan</span></a></div>
                <div class="shortcut"><a href="https://github.dev/sadeknifuri/ladingpage">EDITAR<br><span>BigoteMan</span></a></div>
                <div class="shortcut"><a href="https://ladingpage-6mq.pages.dev/">Deploy<br><span>BigoteMan</span></a></div>
                <div class="shortcut"><a href="https://github.dev/sadekyamil/sadekyamil.github.io">EDITAR<br><span>pagina-inicio</span></a></div>
                <div class="shortcut"><a href="https://github.com/sadekyamil/clase-innovacion">REPOSITORIO<br><span>innovacion</span></a></div>
                <div class="shortcut"><a href="https://dash.cloudflare.com/c1858a93e7246c885d0a6d4f73f2b7a3/workers-and-pages?type=pages&sortBy=name">CLOUDFLARE<br><span>pages</span></a></div>
                <div class="shortcut"><a href="https://github.com/sdekyamil/sadekyamil.github.io/edit/main/index.html">EDITAR<br><span>sadekyamil.io</span></a></div>
                <div class="shortcut"><a href="https://imgto.xyz/">imgto.xyz</a></div>
                <div class="shortcut"><a href="https://www.photopea.com/">Photopea</a></div>
                <div class="shortcut"><a href="https://sadeknifuri.github.io/temporizador.html">Temporizador</a></div>
                <div class="shortcut"><a href="https://chromewebstore.google.com/detail/adguard-adblocker/bgnkhhnnamicmpeenaelnjfhikgbkllg?hl=en-US&utm_source=ext_sidebar">AdGuard</a></div>
                <div class="shortcut"><a href="https://experienciavivo.duoc.cl/alumnos" >vivoDUOC</a></div>
                <div class="shortcut"><a href="https://es.finance.yahoo.com/">mercado pago</a></div>
                <div class="shortcut"><a href="https://es.finance.yahoo.com/">stripe</a></div>
                <div class="shortcut"><a href="https://transferencias.global66.com/signin?redirect=%2Fhome">global66</a></div>
                <div class="shortcut"><a href="https://platform.nexo.com/">nexo</a></div>
                <div class="shortcut"><a href="https://www.google.com/finance/?authuser=0">GOOGLE<br><span>finance</span></a></div>
                <div class="shortcut"><a href="https://es.finance.yahoo.com/">YAHOO<br><span>finance</span></a></div>
                <div class="shortcut"><a href="https://www.interactivebrokers.co.uk/sso/Login?RL=1&locale=en_US">IBKR</a></div>
            </div>
        </div>
    </div>

    <!-- SDK de Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        const firebaseConfig = {
          apiKey: "AIzaSyAOyAQokAU7Lu9Qj6geDW2wE3mYFcPEWJA",
          authDomain: "mi-pagina-de-inicio.firebaseapp.com",
          projectId: "mi-pagina-de-inicio",
          storageBucket: "mi-pagina-de-inicio.appspot.com",
          messagingSenderId: "101136936304",
          appId: "1:101136936304:web:8ac056ca460bb7fac533b5",
          measurementId: "G-5JWTP12ZMR"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        const authContainer = document.getElementById('auth-container');
        const userInfoContainer = document.getElementById('user-info');
        const dashboardContainer = document.getElementById('dashboard');
        const googleSignInBtn = document.getElementById('google-signin-btn');
        const signOutBtn = document.getElementById('signout-btn');
        const userNameEl = document.getElementById('user-name');
        const userPhotoEl = document.getElementById('user-photo');
        
        googleSignInBtn.onclick = () => { signInWithPopup(auth, provider).catch(err => console.error(err)); };
        signOutBtn.onclick = () => { signOut(auth).catch(err => console.error(err)); };

        onAuthStateChanged(auth, (user) => {
            if (user) {
                authContainer.style.display = 'none';
                userInfoContainer.style.display = 'flex';
                dashboardContainer.style.display = 'grid';
                userNameEl.textContent = user.displayName;
                userPhotoEl.src = user.photoURL;
                checkApiKey(); // Comprueba la API Key al iniciar sesión
            } else {
                authContainer.style.display = 'flex';
                userInfoContainer.style.display = 'none';
                dashboardContainer.style.display = 'none';
            }
        });

        // --- LÓGICA DE CHAT CON GEMINI API ---
        const geminiForm = document.getElementById('gemini-search-form');
        const geminiInput = document.getElementById('gemini-search-input');
        const geminiResponseArea = document.getElementById('gemini-response-area');
        const apiKeySetup = document.getElementById('api-key-setup');
        const apiKeyInput = document.getElementById('api-key-input');
        const saveApiKeyBtn = document.getElementById('save-api-key-btn');

        function checkApiKey() {
            const storedKey = localStorage.getItem('geminiApiKey');
            if (!storedKey) {
                apiKeySetup.style.display = 'block';
                geminiResponseArea.innerHTML = 'Para chatear con Gemini, primero debes guardar tu clave de API.';
            } else {
                apiKeySetup.style.display = 'none';
                geminiResponseArea.innerHTML = '';
            }
        }

        saveApiKeyBtn.addEventListener('click', () => {
            const key = apiKeyInput.value.trim();
            if (key) {
                localStorage.setItem('geminiApiKey', key);
                apiKeyInput.value = '';
                checkApiKey();
                geminiResponseArea.innerHTML = '¡Clave guardada! Ya puedes hacer una pregunta.';
            }
        });

        geminiForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const query = geminiInput.value.trim();
            const geminiApiKey = localStorage.getItem('geminiApiKey');

            if (!query) return;
            if (!geminiApiKey) {
                checkApiKey();
                return;
            }

            geminiResponseArea.innerHTML = '<div class="loader"></div>';
            geminiInput.value = '';

            try {
                // CORRECCIÓN: Usar el modelo gemini-1.5-flash-latest
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${geminiApiKey}`;
                const requestBody = { contents: [{ parts: [{ text: query }] }] };
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();

                if (!response.ok) {
                    // Si la respuesta no es OK, lanza un error con el mensaje de la API
                    throw new Error(data.error.message || `Error de red: ${response.statusText}`);
                }
                
                if (data.candidates && data.candidates.length > 0) {
                    geminiResponseArea.innerText = data.candidates[0].content.parts[0].text;
                } else if (data.promptFeedback) {
                    geminiResponseArea.innerText = "La pregunta fue bloqueada por razones de seguridad. Intenta con otra pregunta.";
                } else {
                    geminiResponseArea.innerText = "No se recibió una respuesta válida de Gemini.";
                }

            } catch (error) {
                console.error('Error al contactar la API de Gemini:', error);
                geminiResponseArea.innerText = `Ocurrió un error: ${error.message}`;

                // Si el error es de clave inválida, borra la clave y muestra la configuración
                if (error.message.toLowerCase().includes("api key not valid")) {
                    localStorage.removeItem('geminiApiKey');
                    checkApiKey();
                    geminiResponseArea.innerText = "La clave de API no es válida. Por favor, introduce una nueva.";
                }
            }
        });
    </script>
</body>
</html>
